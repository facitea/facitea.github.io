<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>피드 테스트 페이지</title>
    <style>
      .feedWrapper{
            border: 2px solid black;
            background-color: gray;
        }

        .feedHeader{
            display: flex;
            justify-content: space-between;
        }
        .headerLeft{
            display: flex;
        }
        .feedInteraction{
            display: flex;
            justify-content: space-between;
        }
        .feedInteractionDetail{
            display: flex;
        }
    </style>
</head>
<body>
  <div id="wrapper">.</div>
  <input type="button" onclick="run();">
  <input type="button" onclick="getNextFeedData();" value="새로가져오기">

  <div class="feedWrapper">
    <div class="feedHeader">
      <div class="headerLeft">
        <div class="profileImage">프사</div>
        <div class="userNickname">닉네임</div>
      </div>
      
      <div>
        <div class="feedSetting">설정</div>
      </div>
    </div>
    
    <div class="feedImage">메인사진</div>
    
    <div class="feedInteraction">
      <div class="feedInteractionDetail">
        <div class="iLikeIt">좋아요</div>
        <div class="wrtComment">댓글</div>
        <div class="sendToMsg">메시지</div>
      </div>
      
      <div>
        <div class="bookmark">저장</div>
      </div>
    </div>
    
    <div class="interactionStatus">
      <div class="howManyLikey">좋아요 n개</div>
    </div>
    
    <div>
      <div class="feedText" id="1ContentValue">게시글내용</div>
    </div>

    <div>
      <div class="createdDate">날짜</div>
    </div>
  </div>

  <div class="feedWrapper">
    <div class="feedHeader">
      <div class="headerLeft">
        <div class="profileImage">프사</div>
        <div class="userNickname">닉네임</div>
      </div>
      
      <div>
        <div class="feedSetting">설정</div>
      </div>
    </div>
    
    <div class="feedImage">메인사진</div>
    
    <div class="feedInteraction">
      <div class="feedInteractionDetail">
        <div class="iLikeIt">좋아요</div>
        <div class="wrtComment">댓글</div>
        <div class="sendToMsg">메시지</div>
      </div>
      
      <div>
        <div class="bookmark">저장</div>
      </div>
    </div>
    
    <div class="interactionStatus">
      <div class="howManyLikey">좋아요 n개</div>
    </div>
    
    <div>
      <div class="feedText" id="2ContentValue">게시글내용</div>
    </div>

    <div>
      <div class="createdDate">날짜</div>
    </div>
  </div>
  <div class="feedWrapper">
    <div class="feedHeader">
      <div class="headerLeft">
        <div class="profileImage">프사</div>
        <div class="userNickname">닉네임</div>
      </div>
      
      <div>
        <div class="feedSetting">설정</div>
      </div>
    </div>
    
    <div class="feedImage">메인사진</div>
    
    <div class="feedInteraction">
      <div class="feedInteractionDetail">
        <div class="iLikeIt">좋아요</div>
        <div class="wrtComment">댓글</div>
        <div class="sendToMsg">메시지</div>
      </div>
      
      <div>
        <div class="bookmark">저장</div>
      </div>
    </div>
    
    <div class="interactionStatus">
      <div class="howManyLikey">좋아요 n개</div>
    </div>
    
    <div>
      <div class="feedText" id="3ContentValue">게시글내용</div>
    </div>

    <div>
      <div class="createdDate">날짜</div>
    </div>
  </div>
  <div class="feedWrapper">
    <div class="feedHeader">
      <div class="headerLeft">
        <div class="profileImage">프사</div>
        <div class="userNickname">닉네임</div>
      </div>
      
      <div>
        <div class="feedSetting">설정</div>
      </div>
    </div>
    
    <div class="feedImage">메인사진</div>
    
    <div class="feedInteraction">
      <div class="feedInteractionDetail">
        <div class="iLikeIt">좋아요</div>
        <div class="wrtComment">댓글</div>
        <div class="sendToMsg">메시지</div>
      </div>
      
      <div>
        <div class="bookmark">저장</div>
      </div>
    </div>
    
    <div class="interactionStatus">
      <div class="howManyLikey">좋아요 n개</div>
    </div>
    
    <div>
      <div class="feedText" id="4ContentValue">게시글내용</div>
    </div>

    <div>
      <div class="createdDate">날짜</div>
    </div>
  </div>
  <div class="feedWrapper">
    <div class="feedHeader">
      <div class="headerLeft">
        <div class="profileImage">프사</div>
        <div class="userNickname">닉네임</div>
      </div>
      
      <div>
        <div class="createdDate">날짜</div>
      </div>
    </div>
    
    <div class="feedImage">메인사진</div>
    
    <div class="feedInteraction">
      <div class="feedInteractionDetail">
        <div class="iLikeIt">좋아요</div>
        <div class="wrtComment">댓글</div>
        <div class="sendToMsg">메시지</div>
      </div>
      
      <div>
        <div class="bookmark">저장</div>
      </div>
    </div>
    
    <div class="interactionStatus">
      <div class="howManyLikey">좋아요 n개</div>
    </div>
    
    <div>
      <div class="feedText" id="5ContentValue">게시글내용</div>
    </div>

    <div>
      <div class="createdDate">날짜</div>
    </div>
  </div>





  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
  
  <script src="firebase.js"></script>
  <script src="auth.js"></script>

    <script>
      let sival = "hello world";
      
      //아래 함수는 버튼 누르면 나타나는 함수
      function run(){
        document.getElementById('wrapper').innerHTML = `
        <div class="feedWrapper">
            <div class="feedHeader">
              <div class="headerLeft">
                <div class="profileImage">프사${sival}</div>
                <div class="userNickname">닉네임</div>
              </div>
              
              <div>
                <div class="feedSetting">설정</div>
              </div>
            </div>
            
            <div class="feedImage">메인사진</div>
            
            <div class="feedInteraction">
              <div class="feedInteractionDetail">
                <div class="iLikeIt">좋아요</div>
                <div class="wrtComment">댓글</div>
                <div class="sendToMsg">메시지</div>
              </div>
              
              <div>
                <div class="bookmark">저장</div>
              </div>
            </div>
            
            <div class="interactionStatus">
              <div class="howManyLikey">좋아요 n개</div>
            </div>
            
            <div>
              <div class="feedText">게시글내용</div>
            </div>

            <div>
              <div class="createdDate">날짜</div>
            </div>
          </div>
          <div class="feedWrapper">
            <div class="feedHeader">
              <div class="headerLeft">
                <div class="profileImage">프사</div>
                <div class="userNickname">닉네임</div>
              </div>
              
              <div>
                <div class="feedSetting">설정</div>
              </div>
            </div>
            
            <div class="feedImage">메인사진</div>
            
            <div class="feedInteraction">
              <div class="feedInteractionDetail">
                <div class="iLikeIt">좋아요</div>
                <div class="wrtComment">댓글</div>
                <div class="sendToMsg">메시지</div>
              </div>
              
              <div>
                <div class="bookmark">저장</div>
              </div>
            </div>
            
            <div class="interactionStatus">
              <div class="howManyLikey">좋아요 n개</div>
            </div>
            
            <div>
              <div class="feedText">게시글내용</div>
            </div>
            <div>
              <div class="createdDate">날짜</div>
            </div>
          </div>
          <div id="wrapper"></div>
        `
      }
      let text = "korea";
      
      

      var lastfeedId;
      async function lastFeedIdCheck(){
              await db.collection('게시판').orderBy("timeStamp", "desc").limit(1).get().then((결과)=>
                      {
                      결과.forEach((doc)=>{
                          const lastIdCheck = doc.data();//document의 내용물 = doc.data();
                          const lastId = parseInt(lastIdCheck.feedId);//DB에 있는 내가 임의로 지정한 id값은 feedId인데, 그 document의 feedid를 lastId에 담는다는 뜻
                          lastfeedId = parseInt(lastId);
                      })             
              })//함수로 감싸버리기
      }

      async function recentFiveFeedData(){
        await db.collection('게시판').orderBy("feedId", "desc").where("feedId", "<=", lastfeedId)
        .limit(5)
        .get().then((result)=>
            {
            result.forEach((doc)=>{
                //console.log(doc.data());
                list.push(doc.data());
            })            
        })
      }


      var list = [];

      async function getFeedData(){
        await lastFeedIdCheck();
        await recentFiveFeedData();
        
          

          document.getElementById('1ContentValue').innerHTML = list[0].content;
          document.getElementById('2ContentValue').innerHTML = list[1].content;
          document.getElementById('3ContentValue').innerHTML = list[2].content;
          document.getElementById('4ContentValue').innerHTML = list[3].content;
          document.getElementById('5ContentValue').innerHTML = list[4].content;


        list = [];
      }
      getFeedData();//첫 로딩만 이걸로 시행

      async function loadNextFiveFeedData(){
        await db.collection('게시판').orderBy("feedId", "desc").where("feedId", "<=", lastfeedId)
        .limit(5)
        .get().then((result)=>
            {
            result.forEach((doc)=>{
                //console.log(doc.data());
                list.push(doc.data());
            })            
        })
      }

      async function getNextFeedData(){
        lastfeedId = parseInt(lastfeedId - 5);
        await recentFiveFeedData();

        for (i=0; i<5; i++){
          console.log(list[i]);//이 자리에 list 배열 뽑는 코드를 넣어야함
        }

        list = [];
      }

      //6~10번째 자료를 가져오려면 getNextFeedData() 메소드를 통해 가져온 data를 array에 담아
      //자료가 보여줄 만큼 충분히 있으면, 동적으로 HTML을 생성해
      //자료를 HTML에 보여주면 되겠다.
      //
      


      
    </script>
</body>
</html>